<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('./partials/head.ejs') %>
</head>

<body>
    <header>
        <%- include('./partials/header.ejs') %>
        <nav>
            <%- include('./partials/nav.ejs') %>
        </nav>
    </header>
    

    <div class="users-images">
        <div class="users">
            <% users.forEach(item => { %>
            <div class="card">
                <img src="<%= item.avata; %>" class=" card-img-top">
                <a href="/lico/<%= item.userName; %>" class="card-title"><%= item.userName; %></a><br>
                
            </div>
            <% }) %>
        </div>
        <section class="list-image">
            <% images.forEach(image => { %>
            <div class="index-item">
                <!-- Trigger the modal with a button -->
                <a><img src="<%= image.url; %>" class="index-image" data-toggle="modal"
                        data-target="#<%= image.id; %>"></a>

                <!-- SHOW INFO -->
                <div class="show-info">
                    <p><img src="/images/white-heart.png">
                        <% if(image.love) { %>
                        <%= image.love.length; %>
                        <% } %>

                        <img src="/images/comment.png">
                        <% if(image.comments) { %>
                        <%= image.comments.length; %>
                        <% } %>
                    </p>
                </div>
                <!-- END SHOW INFO -->

                <!-- Modal -->
                <div class="modal fade" id="<%= image.id; %>" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                 <!-- User Name -->
                                 <a href="/lico/<%= image.userName; %>">
                                    <h3><img src="<%= image.avataUser; %>" class="user-avata">
                                        <%= image.userName; %></h3>
                                </a>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>

                            </div>
                            <!-- MODAL BODY -->
                            <div class="modal-body">
                                <div>
                                   
                                     <!-- image information -->

                                     <% if(!image.updatedAt) { %>
                                        <p class="date">Date: <%= image.createdAt; %></p>
                                        <%} else { %>
                                        <p class="date">Edit: <%= image.updatedAt; %></p>
                                        <% } %>
    
    
                                        <!-- image Description -->
                                        <p><%= image.description; %></p>

                                    <!-- image -->
                                    <img src="<%= image.url; %>" class="show-image">
                                    <form action="/lico/<%= image.userName; %>/<%= image.id; %>/love" method="POST">
                                        <% if(image.love && image.love.findIndex(item => { return item === name}) >= 0) { %>
                                        <button type="submit" class="love"><img src="/images/heart.png"></button>
                                        <% } else { %>
                                        <button type="submit" class="love"><img src="/images/white-heart.png"></button>
                                        <% } %>
                                    </form>

                                    <!-- Show How many people love this image -->
                                    <% if(image.love) { %>
                                    <p><%= image.love.length; %> people</p>
                                    <% } %>

                                    <!-- END -->

                                   

                                    <!-- write COMMENT -->
                                    <form action="/lico/<%= image.userName; %>/<%= image.id; %>" method="POST">
                                        <label class="current-user"><%= name; %></label>
                                        <input type="text" name="comment" placeholder="write a comment"
                                            class="write-comment">
                                        <input type="submit" value="send" class="send">
                                    </form>

                                    <!-- SHOW ALL COMMENTS -->
                                    <div class="all-comments">
                                        <% if(image.comments) { %>
                                        <% image.comments.forEach(item => { %>
                                        <div class="comment">
                                            <p class="date"><%= item.createdAt; %></p>
                                            <p><img src="<%= item.avataOfUserComment; %>" class="avata-comment"><a
                                                    href="/lico/<%= item.userComment; %>"><%= item.userComment; %></a>
                                                <%= item.content; %>
                                            </p>
                                        </div>

                                        <% }) %>
                                        <% } %>
                                    </div>


                                </div>
                            </div>
                            <!-- END MODAL BODY -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- END modal -->
            </div>
            <% }) %>
        </section>
    </div>

</body>

</html>